P8105 Homework 6
================
Laylah Jones
2023-12-02

# Problem 1

# Problem 2

### Loading the Data

``` r
weather_df = 
  rnoaa::meteo_pull_monitors(
    c("USW00094728"),
    var = c("PRCP", "TMIN", "TMAX"), 
    date_min = "2022-01-01",
    date_max = "2022-12-31") |>
  mutate(
    name = recode(id, USW00094728 = "CentralPark_NY"),
    tmin = tmin / 10,
    tmax = tmax / 10) |>
  select(name, id, everything())
```

    ## using cached file: /Users/laylahjones/Library/Caches/org.R-project.R/R/rnoaa/noaa_ghcnd/USW00094728.dly

    ## date created (size, mb): 2023-09-28 10:44:43.434266 (8.524)

    ## file min/max dates: 1869-01-01 / 2023-09-30

### Creating Bootstrap and Getting Estimates

``` r
boot_sample = function(df) {
  sample_frac(df, replace = TRUE)
}
```

``` r
set.seed(1)

boot_strap = 
  tibble(strap_number = 1:5000) |> 
  mutate(
    strap_sample = map(strap_number, \(i) boot_sample(weather_df))
  )
```

``` r
boot_results = 
  boot_strap |> 
  mutate(
    models = map(strap_sample, \(df) lm(tmax ~ tmin + prcp, data = df)),
    tidy_results = map(models, broom::tidy),
    glance_results = map(models, broom::glance)
  ) |> 
  select(strap_number, tidy_results, glance_results) |> 
  unnest(tidy_results, glance_results)
```

    ## Warning: `unnest()` has a new interface. See `?unnest` for details.
    ## ℹ Try `df %>% unnest(c(tidy_results, glance_results))`, with `mutate()` if
    ##   needed.

``` r
logb1b2_results = boot_results |> 
  select(strap_number, term, estimate, std.error) |> 
  filter(term %in% c("tmin","prcp")) |> 
  pivot_wider(
     names_from = term,
     values_from = c(estimate, std.error)
  ) |> 
  mutate(
    logb1b2 = log(estimate_tmin * estimate_prcp)
  ) 
```

    ## Warning: There was 1 warning in `mutate()`.
    ## ℹ In argument: `logb1b2 = log(estimate_tmin * estimate_prcp)`.
    ## Caused by warning in `log()`:
    ## ! NaNs produced

``` r
rsq_results = boot_results |> 
  select(strap_number, r.squared) |> 
  distinct(.keep_all = TRUE)
```

### Plotting Distribution of Estimates

``` r
logb1b2_results |> 
  ggplot(aes(x = logb1b2)) + 
  geom_density() +
  labs(
    title = "Estimation of log(b1*b2)")
```

    ## Warning: Removed 3361 rows containing non-finite values (`stat_density()`).

<img src="p8105_HW6_lsj2122_files/figure-gfm/plot-1.png" width="90%" />

``` r
rsq_results |> 
  ggplot(aes(x = r.squared)) + 
  geom_density() + 
  labs(
    title = "Esimation of R squared")
```

<img src="p8105_HW6_lsj2122_files/figure-gfm/plot-2.png" width="90%" />

The distribution of ${r^2}$ is normal, with it being centered around
0.920. It shows a visibly heavy tail extending to low values, and a bump
which could be attributed to the occurrence of large outliers withing
the bootstrap samples.

The distribution of log($\hat{beta_1} * \hat{beta_2}$) is uni-modal and
left-skewed. Due to negative precipitation values, and we can see this
distribution after we remove the NA values. The distribution shows an
even more visibly heavy tail extending to the low values, with majority
of the values clustering on the right side.

### 95% CI for log(b1\*b2)

``` r
logb1b2_results |> 
  summarise(
  upperCI = quantile(logb1b2, 0.975, na.rm = TRUE),
  lowerCI = quantile(logb1b2, 0.025, na.rm = TRUE)) |> 
  knitr::kable()
```

|   upperCI |   lowerCI |
|----------:|----------:|
| -4.601673 | -8.981559 |

This is the 95% confidence interval for
log($\hat{beta_1} * \hat{beta_2}$) after removing the NA values.

### 95% CI for R-Squared

``` r
rsq_results |> 
  summarise(
  upperCI = quantile(r.squared, 0.975, na.rm = TRUE),
  lowerCI = quantile(r.squared, 0.025, na.rm = TRUE)) |> 
  knitr::kable()
```

|   upperCI |   lowerCI |
|----------:|----------:|
| 0.9406812 | 0.8885495 |

# Problem 3

### Loading the data

``` r
birthweight_df = 
  read_csv("data/birthweight.csv") |> 
  janitor::clean_names() |> 
  mutate(
    babysex = factor(babysex, levels = c(1,2), labels = c("male", "female")), 
    frace = factor(frace, levels = c(1, 2, 3, 4, 8, 9), labels = c("White", "Black", "Asian", "Puerto Rican", "Other", "Unknown"))
  )
```
