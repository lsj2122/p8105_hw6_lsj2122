---
title: "P8105 Homework 6"
author: "Laylah Jones"
date: 2023-12-02
output: github_document
---

```{r, include=FALSE, message = FALSE, warning = FALSE}
library(tidyverse)
library(ggplot2)


options(readr.show_col_types = FALSE)

knitr::opts_chunk$set(
  fig.width = 8,
  fig.height = 6,
  out.width = "90%"
)

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = ("viridis"))

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

# Problem 1


# Problem 2

### Loading the Data

```{r, load}
weather_df = 
  rnoaa::meteo_pull_monitors(
    c("USW00094728"),
    var = c("PRCP", "TMIN", "TMAX"), 
    date_min = "2022-01-01",
    date_max = "2022-12-31") |>
  mutate(
    name = recode(id, USW00094728 = "CentralPark_NY"),
    tmin = tmin / 10,
    tmax = tmax / 10) |>
  select(name, id, everything())
```

### Creating the DF with Estimates

```{r, estimates}
weather_data = 
  weather_df |> 
  modelr::bootstrap(n = 5000) |> 
  mutate(
    models = map(strap, \(df) lm(tmax ~ tmin + prcp, data = df)),
    r2 = map(models, broom::glance),
    results = map(models, broom::tidy)) |>
  select(.id,results,r2) |> 
  unnest(r2, results) |>
  select(.id, r.squared, term, estimate) |>
  pivot_wider(
    names_from = term,
    values_from = estimate
  ) |>
  mutate(
    log_b1_b2 = log(tmin * prcp)
  ) |>
  select(.id, r.squared, log_b1_b2)
```

### Plotting Distribution of Estimates

```{r, plot}
weather_data |>
  ggplot(aes(x = r.squared)) +
  geom_density() +
  labs(
    title = "Estimation of R Squared"
  )
```

The distribution of ${r^2}$ is normal, with it being centered around 0.920. It shows a visibly heavy tail extending to low values, and a bump which could be attributed to the occurance of large outliers withing the bootstrap samples.

```{r, plot2}
weather_data |>
  ggplot(aes(x = log_b1_b2)) +
  geom_density() + 
  labs(
    title = "Estimation of log(b1b2)"
  )
```

The distribution of log($\hat{beta_1} * \hat{beta_2}$) is uni-modal and left-skewed. There are `r sum(is.na(pull(weather_data, log_b1_b2)))/nrow(weather_data)*100` NA values, due to negative precipitation values, and we can see this distribution after we remove the NA values. The distribution shows an even more visibly heavy tail extending to the low values, with majority of the values clustering on the right side.


### 95% CI for log(b1*b2)

```{r, CI}
quantile(
  pull(weather_data, log_b1_b2),
  probs = c(0.025, 0.975), 
  na.rm = TRUE
) |> 
  knitr::kable()
```

This is the 95% confidence interval for log($\hat{beta_1} * \hat{beta_2}$) after removing the NA values.

### 95% CI for R-Squared

```{r, CI_R}
quantile(
  pull(weather_data, r.squared),
  probs = c(0.025, 0.975)
) |> 
  knitr::kable()
```


# Problem 3

### Loading the data

```{r}

```

